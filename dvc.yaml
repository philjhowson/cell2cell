stages:
  preprocess:
    cmd: python src/data/data_formatting.py
    deps:
    - data/raw/cell2celltrain.csv
    - src/data/data_utils.py
    - src/data/data_formatting.py
    outs:
    - data/processed/train_index.pkl
    - data/processed/test_index.pkl
    - encoders/OneHotEncoder.pkl
    - encoders/SimpleImputer.pkl
    - encoders/TargetEncoder.pkl
    - data/processed/X_test.csv
    - data/processed/X_train.csv
    - data/processed/y_test.csv
    - data/processed/y_train.csv
  eda:
    cmd: python src/data/data_exploration.py
    deps:
    - src/data/data_exploration.py
    - src/data/data_utils.py
    - data/processed/X_train.csv
    - data/processed/y_train.csv
    outs:
    - images/eda/
    - data/processed/highly_correlated_feature_pairs.pkl
  feature_engineering:
    cmd: python src/data/feature_engineering.py
    deps:
    - src/data/feature_engineering.py
    - src/data/data_utils.py
    - data/processed/X_train.csv
    - data/processed/X_test.csv
    outs:
    - encoders/MinMaxScaler.pkl
    - encoders/PCA_transformer_scaled.pkl
    - encoders/PCA_transformer_smote.pkl
    - data/processed/scaled/X_train_scaled.csv
    - data/processed/scaled/X_test_scaled.csv
    - data/processed/scaled/X_train_scaled_pca.csv
    - data/processed/scaled/X_test_scaled_pca.csv
    - data/processed/smote/X_train_smote.csv
    - data/processed/smote/y_train_smote.csv
    - data/processed/smote/X_train_smote_pca.csv
    - data/processed/smote/X_test_smote_pca.csv
  rfecv_feature_reduction:
    foreach:
      - model: log
        sample: scaled
      - model: rf
        sample: scaled
      - model: xgb
        sample: scaled
      - model: log
        sample: smote
      - model: rf
        sample: smote
      - model: xgb
        sample: smote
    do:
      cmd: python src/data/rfecv_feature_reduction.py --model ${item.model} --sample ${item.sample}
      deps:
      - src/data/rfecv_feature_reduction.py
      - src/data/data_utils.py
      - data/processed/scaled/X_train_scaled.csv
      - data/processed/y_train.csv
      - data/processed/smote/X_train_smote.csv
      - data/processed/smote/y_train_smote.csv
      outs:
      - data/processed/${item.sample}/RFECV_features_${item.model}.pkl
  pso_feature_reduction:
    foreach:
      - model: log
        sample: scaled
      - model: rf
        sample: scaled
      - model: xgb
        sample: scaled
      - model: log
        sample: smote
      - model: rf
        sample: smote
      - model: xgb
        sample: smote
    do:
      cmd: python src/data/pso_feature_reduction.py --model ${item.model} --sample ${item.sample}
      deps:
      - src/data/pso_feature_reduction.py
      - src/data/data_utils.py
      - src/data/pso_utils.py
      - data/processed/pso_options.pkl
      - data/processed/scaled/X_train_scaled.csv
      - data/processed/y_train.csv
      - data/processed/smote/X_train_smote.csv
      - data/processed/smote/y_train_smote.csv
      outs:
      - data/processed/${item.sample}/pso_feature_set_${item.model}.pkl